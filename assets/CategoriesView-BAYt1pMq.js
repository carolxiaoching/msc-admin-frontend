import{m as q,n as N,d as B,o as j}from"./api-tKCg3TZ9.js";import{l as F,m as S,r,a0 as z,M as G,d as R,c as h,o as $,a as e,b as d,w as C,e as O,a1 as P,f as c,n as L,t as n,z as H,F as D,S as J}from"./index-CIIQbgs8.js";import{_ as K,a as Q}from"./DelModal-DsZnU4wa.js";import{_ as W}from"./UploadComponent-D4StFv5R.js";const X={class:"modal-dialog modal-dialog-centered"},Y={class:"modal-content overflow-hidden"},Z={class:"p-11"},ee={class:"modal-title title mb-8",id:"categoryEditModalLabel"},te={class:"mb-8"},ae={class:"mb-4 text-center text-danger"},le={class:"flex-fill mx-lg-16"},se={key:0},oe={class:"d-flex px-11 py-8 bg-light"},de=["onClick"],ne=["disabled"],ie={__name:"CategoryEditModal",props:{tempCategory:{type:Object,default(){return{id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""}}}},emits:["getCategories"],setup(T,{expose:U,emit:A}){const M=F(),u=S(),{openLoading:g,closeLoading:v}=M,{pushMessage:m}=u,p=r(null),{openModal:k,hideModal:b}=z(p),l=r({id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""});U({openModal:k,hideModal:b});const y=T,w=A;G(y,s=>{l.value=s.tempCategory});async function V(s,{resetForm:t}){var i,f;g();const a=l.value.id?q:N,o=l.value.id?"更新":"新增";try{const _=await a({title:l.value.title,categoryImgUrl:l.value.categoryImgUrl},l.value.id),{status:E}=_.data;E==="success"?(m({style:"success",title:`${o}成功`,text:`分類${o}成功，請等待載入畫面`}),t(),w("getCategories")):m({style:"danger",title:`${o}失敗`,text:`分類${o}失敗，請重整網頁`}),v(),b()}catch(_){m({style:"danger",title:`${o}失敗`,text:((f=(i=_.response)==null?void 0:i.data)==null?void 0:f.message)||`分類${o}失敗，請重整網頁`}),v()}}function I(s){l.value.categoryImgUrl=s}return(s,t)=>{const a=R("VField"),o=R("ErrorMessage"),i=R("VForm");return $(),h("div",{class:"modal fade",id:"categoryEditModal",tabindex:"-1","aria-labelledby":"categoryEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"categoryEditModalRef",ref:p},[e("div",X,[e("div",Y,[d(i,{class:"modal-body p-0",ref:"form",onSubmit:V},{default:C(({errors:f,meta:_,resetForm:E})=>[e("div",Z,[e("h1",ee,[t[3]||(t[3]=e("span",{class:"titleIcon bg-dark-subtl"},[e("i",{class:"bi bi-pencil-fill"})],-1)),P(s.$slots,"modal-header",{},()=>[t[2]||(t[2]=c("標題"))])]),e("div",te,[t[4]||(t[4]=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),c(" 分類標題： ")],-1)),d(a,{type:"text",name:"分類標題",id:"title",class:L(["form-control",{"is-invalid":f.分類標題}]),placeholder:"請輸入分類標題",rules:"required",modelValue:l.value.title,"onUpdate:modelValue":t[0]||(t[0]=x=>l.value.title=x),required:""},null,8,["class","modelValue"]),d(o,{name:"分類標題",class:"invalid-feedback"})]),e("div",{class:L([l.value.createdAt?"mb-16":"mb-8"])},[t[5]||(t[5]=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),c(" 分類圖片 ")],-1)),d(a,{type:"text",id:"coverImgUrl",class:"d-none",name:"分類圖片",modelValue:l.value.categoryImgUrl,"onUpdate:modelValue":t[1]||(t[1]=x=>l.value.categoryImgUrl=x),rules:"required",required:""},null,8,["modelValue"]),d(o,{name:"分類圖片"},{default:C(({message:x})=>[e("p",ae,n(x),1)]),_:1}),e("div",le,[d(W,{"temp-image-url":l.value.categoryImgUrl,imageType:"icon",onUpdateImage:I},null,8,["temp-image-url"])])],2),l.value.createdAt?($(),h("div",se,[e("p",null,"建立時間："+n(s.$getTime(l.value.createdAt)),1),e("p",null,"更新時間："+n(s.$getTime(l.value.updatedAt)),1)])):O("",!0)]),e("div",oe,[e("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:E}," 取消 ",8,de),e("button",{type:"submit","aria-disabled":"true",class:L(["w-50 btn btn-primary",{disabled:!_.valid}]),disabled:!_.valid}," 確定送出 ",10,ne)])]),_:3},512)])])],512)}}},re={class:"mb-8 text-end"},ce={class:"table-responsive"},ue={class:"table mb-14 align-middle"},ge={class:"d-none d-sm-table-cell text-center"},me={class:"d-flex flex-column flex-md-row justify-content-center align-items-center"},pe=["src"],be={class:"d-none d-xxl-table-cell text-center"},ye={class:"d-none d-xxl-table-cell text-center"},fe={class:"text-center"},_e={class:"btn-group btn-group-sm",role:"group"},ve=["onClick"],xe=["onClick"],ke={__name:"CategoriesView",setup(T){const U=F(),A=S(),{openLoading:M,closeLoading:u}=U,{pushMessage:g}=A,v=r([]),m=r({}),p=r(null),k=r(null),b=r({id:"",title:""}),l=r({id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""});async function y(s=1){var t,a;M();try{const o=await B({page:s});v.value=o.data.data.results,m.value=o.data.data.pagination,u()}catch(o){g({style:"danger",title:"載入失敗",text:((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),u()}}async function w(s){var t,a,o;M();try{const i=await j(s),{status:f}=i.data;f==="success"?(g({style:"success",title:"刪除成功",text:"分類刪除成功，請等待載入畫面"}),y()):g({style:"danger",title:"刪除失敗",text:"分類刪除失敗，請重整網頁"}),(t=p.value)==null||t.hideModal(),u()}catch(i){g({style:"danger",title:"刪除失敗",text:((o=(a=i.response)==null?void 0:a.data)==null?void 0:o.message)||"分類刪除失敗，請重整網頁"}),u()}}function V(s){var t;b.value={id:s._id,title:s.title},(t=p.value)==null||t.openModal()}function I(s,t){var a;s==="create"?l.value={id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""}:l.value={id:t._id,title:t.title,categoryImgUrl:t.categoryImgUrl,createdAt:t.createdAt,updatedAt:t.updatedAt},(a=k.value)==null||a.openModal()}return H(()=>{y()}),(s,t)=>($(),h(D,null,[t[5]||(t[5]=e("h1",{class:"mb-4 h3"},"分類管理",-1)),e("div",re,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=a=>I("create"))},t[1]||(t[1]=[e("i",{class:"bi bi-plus-lg me-8"},null,-1),c(" 新增分類 ")]))]),e("div",ce,[e("table",ue,[t[2]||(t[2]=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"分類名稱"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1)),e("tbody",null,[($(!0),h(D,null,J(v.value,a=>($(),h("tr",{key:a._id},[e("td",ge,"#"+n(a._id.slice(-5)),1),e("td",me,[e("img",{src:a.categoryImgUrl,class:"thumbnail me-4"},null,8,pe),c(" "+n(a.title),1)]),e("td",be,n(s.$getTime(a.createdAt)),1),e("td",ye,n(s.$getTime(a.updatedAt)),1),e("td",fe,[e("div",_e,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:o=>I("edit",a)}," 編輯 ",8,ve),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>V(a)}," 刪除 ",8,xe)])])]))),128))])])]),d(K,{pagination:m.value,onUpdatePage:y},null,8,["pagination"]),d(Q,{ref_key:"delModalRef",ref:p,"del-id":b.value.id,onDelItem:w},{"modal-header":C(()=>t[3]||(t[3]=[c(" 刪除分類 ")])),"modal-content":C(()=>[t[4]||(t[4]=c(" 確定要刪除 ")),e("strong",null," 分類： "+n(b.value.title),1)]),_:1},8,["del-id"]),d(ie,{ref_key:"categoryEditModalRef",ref:k,"temp-category":l.value,onGetCategories:y},{"modal-header":C(()=>[c(n(l.value.id?"編輯分類":"新增分類"),1)]),_:1},8,["temp-category"])],64))}};export{ke as default};
