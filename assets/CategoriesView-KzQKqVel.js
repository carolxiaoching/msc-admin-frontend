import{m as q,n as z,d as N,o as B}from"./api-BuVyP45F.js";import{l as F,m as S,r,a1 as j,M as G,d as R,c as h,o as $,a as e,b as n,w as C,e as O,a2 as P,f as c,n as D,t as i,z as W,F as L,S as H,T as J,W as K}from"./index-DLEIqx4g.js";import{_ as Q,a as X}from"./DelModal-DSvRl_CF.js";import{_ as Y}from"./UploadComponent-h3FBgQMM.js";const Z={class:"modal-dialog modal-dialog-centered"},ee={class:"modal-content overflow-hidden"},te={class:"p-11"},ae={class:"modal-title title mb-8",id:"categoryEditModalLabel"},le={class:"mb-8"},se={class:"mb-4 text-center text-danger"},oe={class:"flex-fill mx-lg-16"},de={key:0},ne={class:"d-flex px-11 py-8 bg-light"},ie=["onClick"],re=["disabled"],ce={__name:"CategoryEditModal",props:{tempCategory:{type:Object,default(){return{id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""}}}},emits:["getCategories"],setup(T,{expose:U,emit:A}){const M=F(),u=S(),{openLoading:g,closeLoading:_}=M,{pushMessage:m}=u,p=r(null),{openModal:k,hideModal:b}=j(p),l=r({id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""});U({openModal:k,hideModal:b});const y=T,w=A;G(y,s=>{l.value=s.tempCategory});async function V(s,{resetForm:t}){var d,f;g();const o=l.value.id?q:z,a=l.value.id?"更新":"新增";try{const v=await o({title:l.value.title,categoryImgUrl:l.value.categoryImgUrl},l.value.id),{status:E}=v.data;E==="success"?(m({style:"success",title:`${a}成功`,text:`分類${a}成功，請等待載入畫面`}),t(),w("getCategories")):m({style:"danger",title:`${a}失敗`,text:`分類${a}失敗，請重整網頁`}),_(),b()}catch(v){m({style:"danger",title:`${a}失敗`,text:((f=(d=v.response)==null?void 0:d.data)==null?void 0:f.message)||`分類${a}失敗，請重整網頁`}),_()}}function I(s){l.value.categoryImgUrl=s}return(s,t)=>{const o=R("VField"),a=R("ErrorMessage"),d=R("VForm");return $(),h("div",{class:"modal fade",id:"categoryEditModal",tabindex:"-1","aria-labelledby":"categoryEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"categoryEditModalRef",ref:p},[e("div",Z,[e("div",ee,[n(d,{class:"modal-body p-0",ref:"form",onSubmit:V},{default:C(({errors:f,meta:v,resetForm:E})=>[e("div",te,[e("h1",ae,[t[3]||(t[3]=e("span",{class:"titleIcon bg-dark-subtl"},[e("i",{class:"bi bi-pencil-fill"})],-1)),P(s.$slots,"modal-header",{},()=>[t[2]||(t[2]=c("標題"))])]),e("div",le,[t[4]||(t[4]=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),c(" 分類標題： ")],-1)),n(o,{type:"text",name:"分類標題",id:"title",class:D(["form-control",{"is-invalid":f.分類標題}]),placeholder:"請輸入分類標題",rules:"required",modelValue:l.value.title,"onUpdate:modelValue":t[0]||(t[0]=x=>l.value.title=x),required:""},null,8,["class","modelValue"]),n(a,{name:"分類標題",class:"invalid-feedback"})]),e("div",{class:D([l.value.createdAt?"mb-16":"mb-8"])},[t[5]||(t[5]=e("label",{for:"title",class:"form-label"},[e("span",{class:"text-danger"},"*"),c(" 分類圖片 ")],-1)),n(o,{type:"text",id:"coverImgUrl",class:"d-none",name:"分類圖片",modelValue:l.value.categoryImgUrl,"onUpdate:modelValue":t[1]||(t[1]=x=>l.value.categoryImgUrl=x),rules:"required",required:""},null,8,["modelValue"]),n(a,{name:"分類圖片"},{default:C(({message:x})=>[e("p",se,i(x),1)]),_:1}),e("div",oe,[n(Y,{"temp-image-url":l.value.categoryImgUrl,imageType:"icon",onUpdateImage:I},null,8,["temp-image-url"])])],2),l.value.createdAt?($(),h("div",de,[e("p",null,"建立時間："+i(s.$getTime(l.value.createdAt)),1),e("p",null,"更新時間："+i(s.$getTime(l.value.updatedAt)),1)])):O("",!0)]),e("div",ne,[e("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:E}," 取消 ",8,ie),e("button",{type:"submit","aria-disabled":"true",class:D(["w-50 btn btn-primary",{disabled:!v.valid}]),disabled:!v.valid}," 確定送出 ",10,re)])]),_:3},512)])])],512)}}},ue={class:"mb-8 text-end"},ge={class:"table-responsive"},me={class:"table mb-14 align-middle"},pe={class:"d-none d-sm-table-cell text-center"},be={class:"d-flex flex-column flex-md-row justify-content-center align-items-center"},ye={class:"thumbnail me-4"},fe={class:"d-none d-xxl-table-cell text-center"},ve={class:"d-none d-xxl-table-cell text-center"},_e={class:"text-center"},xe={class:"btn-group btn-group-sm",role:"group"},he=["onClick"],$e=["onClick"],Ue={__name:"CategoriesView",setup(T){const U=F(),A=S(),{openLoading:M,closeLoading:u}=U,{pushMessage:g}=A,_=r([]),m=r({}),p=r(null),k=r(null),b=r({id:"",title:""}),l=r({id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""});async function y(s=1){var t,o;M();try{const a=await N({page:s});_.value=a.data.data.results,m.value=a.data.data.pagination,u()}catch(a){g({style:"danger",title:"載入失敗",text:((o=(t=a.response)==null?void 0:t.data)==null?void 0:o.message)||"載入失敗，請重整網頁"}),u()}}async function w(s){var t,o,a;M();try{const d=await B(s),{status:f}=d.data;f==="success"?(g({style:"success",title:"刪除成功",text:"分類刪除成功，請等待載入畫面"}),y()):g({style:"danger",title:"刪除失敗",text:"分類刪除失敗，請重整網頁"}),(t=p.value)==null||t.hideModal(),u()}catch(d){g({style:"danger",title:"刪除失敗",text:((a=(o=d.response)==null?void 0:o.data)==null?void 0:a.message)||"分類刪除失敗，請重整網頁"}),u()}}function V(s){var t;b.value={id:s._id,title:s.title},(t=p.value)==null||t.openModal()}function I(s,t){var o;s==="create"?l.value={id:"",title:"",categoryImgUrl:"",createdAt:"",updatedAt:""}:l.value={id:t._id,title:t.title,categoryImgUrl:t.categoryImgUrl,createdAt:t.createdAt,updatedAt:t.updatedAt},(o=k.value)==null||o.openModal()}return W(()=>{y()}),(s,t)=>{const o=J("lazy");return $(),h(L,null,[t[5]||(t[5]=e("h1",{class:"mb-4 h3"},"分類管理",-1)),e("div",ue,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=a=>I("create"))},t[1]||(t[1]=[e("i",{class:"bi bi-plus-lg me-8"},null,-1),c(" 新增分類 ")]))]),e("div",ge,[e("table",me,[t[2]||(t[2]=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"分類名稱"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1)),e("tbody",null,[($(!0),h(L,null,H(_.value,a=>($(),h("tr",{key:a._id},[e("td",pe,"#"+i(a._id.slice(-5)),1),e("td",be,[K(e("img",ye,null,512),[[o,a.categoryImgUrl]]),c(" "+i(a.title),1)]),e("td",fe,i(s.$getTime(a.createdAt)),1),e("td",ve,i(s.$getTime(a.updatedAt)),1),e("td",_e,[e("div",xe,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:d=>I("edit",a)}," 編輯 ",8,he),e("button",{type:"button",class:"btn btn-outline-danger",onClick:d=>V(a)}," 刪除 ",8,$e)])])]))),128))])])]),n(Q,{pagination:m.value,onUpdatePage:y},null,8,["pagination"]),n(X,{ref_key:"delModalRef",ref:p,"del-id":b.value.id,onDelItem:w},{"modal-header":C(()=>t[3]||(t[3]=[c(" 刪除分類 ")])),"modal-content":C(()=>[t[4]||(t[4]=c(" 確定要刪除 ")),e("strong",null," 分類： "+i(b.value.title),1)]),_:1},8,["del-id"]),n(ce,{ref_key:"categoryEditModalRef",ref:k,"temp-category":l.value,onGetCategories:y},{"modal-header":C(()=>[c(i(l.value.id?"編輯分類":"新增分類"),1)]),_:1},8,["temp-category"])],64)}}};export{Ue as default};
