import{e as S,d as V,c as B,i as G}from"./api-DjhJghTv.js";import{l as L,m as z,r,z as A,c as o,a as e,b as x,w as p,d as F,F as y,S as M,o as d,f as u,t as n,O as N,Q as E,W as O,n as Q}from"./index-Bo7Zo3EM.js";import{_ as W,a as j}from"./DelModal-Bw6rNs7v.js";const q={class:"mb-8 text-end"},H={class:"table-responsive"},J={class:"table align-middle mb-14"},K={class:"d-none d-md-table-cell text-center"},X={class:"text-center"},Y={class:"d-flex align-items-center"},Z=["src"],ee={key:1,class:"thumbnail me-4"},te={class:"d-none d-md-table-cell text-center"},se={class:"d-none d-xxl-table-cell text-center"},le={class:"d-flex flex-wrap mb-0 list-unstyled"},ae={class:"badge text-bg-secondary"},ne={class:"d-none d-xxl-table-cell text-center"},oe={class:"d-none d-lg-table-cell text-center"},de={class:"d-flex align-items-center"},ce=["src"],ie={key:1,class:"thumbnail me-4 rounded-circle"},re={class:"d-none d-xxl-table-cell text-center"},ue={class:"d-none d-xxl-table-cell text-center"},ge={class:"d-none d-xxl-table-cell text-center"},be={class:"text-center"},_e={class:"btn-group btn-group-sm",role:"group"},xe=["onClick"],pe={class:"mb-8"},ye={__name:"RecipesView",setup(he){const P=L(),$=z(),{openLoading:h,closeLoading:c}=P,{pushMessage:g}=$,w=r([]),k=r([]),R=r([]),C=r({}),m=r(null),b=r({id:"",title:""});async function f(l=1){var s,a;h();try{const t=await B({page:l});w.value=t.data.data.results,C.value=t.data.data.pagination,c()}catch(t){g({style:"danger",title:"載入失敗",text:((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),c()}}async function I(){var l,s;h();try{const a=await S({noPagination:!0}),t=await V({noPagination:!0});R.value=a.data.data,k.value=t.data.data,await f(),c()}catch(a){g({style:"danger",title:"載入失敗",text:((s=(l=a.response)==null?void 0:l.data)==null?void 0:s.message)||"載入失敗，請重整網頁"}),c()}}async function T(l){var s,a,t;h();try{const i=await G(l),{status:_}=i.data;_==="success"?(g({style:"success",title:"刪除成功",text:"刪除成功，請等待載入畫面"}),f()):g({style:"danger",title:"刪除失敗",text:"刪除失敗，請重整網頁"}),(s=m.value)==null||s.hideModal(),c()}catch(i){g({style:"danger",title:"刪除失敗",text:((t=(a=i.response)==null?void 0:a.data)==null?void 0:t.message)||"刪除失敗，請重整網頁"}),c()}}function U(l){var s;b.value={id:l._id,title:l.title},(s=m.value)==null||s.openModal()}return A(()=>{I()}),(l,s)=>{const a=F("router-link");return d(),o(y,null,[s[6]||(s[6]=e("h1",{class:"mb-4 h3"},"食譜管理",-1)),e("div",q,[x(a,{to:"/dashboard/recipe/new",class:"btn btn-primary"},{default:p(()=>s[0]||(s[0]=[e("i",{class:"bi bi-plus-lg me-8"},null,-1),u(" 新增食譜 ")])),_:1})]),e("div",H,[e("table",J,[s[4]||(s[4]=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"食譜名稱"),e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"分類"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"標籤"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"80"},"收藏人數"),e("th",{class:"d-none d-lg-table-cell text-center",width:"120"},"發布者"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"公開狀態"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"120"},"更新時間"),e("th",{class:"text-center",width:"200"},"編輯")])],-1)),e("tbody",null,[(d(!0),o(y,null,M(w.value,t=>{var i,_,D;return d(),o("tr",{key:t._id},[e("td",K,"#"+n(t._id.slice(-5)),1),e("td",X,[e("div",Y,[t.coverImgUrl?(d(),o("img",{key:0,src:t.coverImgUrl,class:"thumbnail me-4"},null,8,Z)):(d(),o("div",ee,s[1]||(s[1]=[e("i",{class:"bi bi-person-fill"},null,-1)]))),u(" "+n(t.title),1)])]),e("td",te,n(N(E)(k.value,t.category)),1),e("td",se,[e("ul",le,[(d(!0),o(y,null,M(t.tags,v=>(d(),o("li",{class:"me-4 fs-6",key:v},[e("span",ae,n(N(O)(R.value,v)),1)]))),128))])]),e("td",ne,n(t.collectsCount),1),e("td",oe,[e("div",de,[(i=t.user)!=null&&i.avatarImgUrl?(d(),o("img",{key:0,src:(_=t.user)==null?void 0:_.avatarImgUrl,class:"thumbnail me-4 rounded-circle"},null,8,ce)):(d(),o("div",ie,s[2]||(s[2]=[e("i",{class:"bi bi-person-fill"},null,-1)]))),u(" "+n((D=t.user)==null?void 0:D.nickName),1)])]),e("td",re,[e("span",{class:Q(["badge",{"text-bg-primary":t.isPublic,"text-bg-light":!t.isPublic}])},n(t.isPublic?"公開":"私人"),3)]),e("td",ue,n(l.$getTime(t.createdAt)),1),e("td",ge,n(l.$getTime(t.updatedAt)),1),e("td",be,[e("div",_e,[x(a,{to:`/dashboard/recipe/${t._id}`,class:"btn btn-outline-dark"},{default:p(()=>s[3]||(s[3]=[u(" 編輯 ")])),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:v=>U(t)}," 刪除 ",8,xe)])])])}),128))])])]),x(W,{pagination:C.value,onUpdatePage:f},null,8,["pagination"]),x(j,{ref_key:"delModalRef",ref:m,"del-id":b.value.id,onDelItem:T},{"modal-header":p(()=>[u(" 刪除食譜 #"+n(b.value.id.slice(-5)),1)]),"modal-content":p(()=>[e("p",pe,[s[5]||(s[5]=u(" 確定要刪除食譜： ")),e("strong",null,n(b.value.title),1)])]),_:1},8,["del-id"])],64)}}};export{ye as default};
