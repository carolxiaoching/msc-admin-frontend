import{t as C,u as L}from"./api-BuVyP45F.js";import{r,a1 as S,c as h,o as f,a as e,a2 as M,f as u,l as V,m as z,z as B,b as $,F as A,S as F,w as g,T as j,t as o,W as w}from"./index-DLEIqx4g.js";import{_ as E,a as G}from"./DelModal-DSvRl_CF.js";const P={class:"modal-dialog modal-dialog-centered"},W={class:"modal-content overflow-hidden"},q={class:"modal-body p-0"},H={class:"p-11"},J={class:"modal-title title mb-8",id:"imageModalLabel"},K={class:"my-11 text-center"},O={__name:"ImageModal",setup(N,{expose:x}){const p=r(null),{openModal:b,hideModal:c}=S(p);return x({openModal:b,hideModal:c}),(d,s)=>(f(),h("div",{class:"modal fade",id:"imageModal",tabindex:"-1","aria-labelledby":"imageModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"imageModalRef",ref:p},[e("div",P,[e("div",W,[e("div",q,[e("div",H,[e("h1",J,[s[1]||(s[1]=e("span",{class:"titleIcon bg-dark-subtle"},[e("i",{class:"bi bi-pencil-fill"})],-1)),M(d.$slots,"modal-header",{},()=>[s[0]||(s[0]=u("標題"))])]),e("div",K,[M(d.$slots,"modal-image",{},()=>[s[2]||(s[2]=u("圖片"))])]),M(d.$slots,"modal-content",{},()=>[s[3]||(s[3]=u("內容"))])]),s[4]||(s[4]=e("div",{class:"px-11 py-8 bg-light text-center"},[e("button",{type:"button",class:"w-50 btn btn-primary","data-bs-dismiss":"modal"},"關閉")],-1))])])])],512))}},Q={class:"table-responsive"},X={class:"table mb-14 align-middle"},Y={class:"d-none d-sm-table-cell text-center"},Z={class:"d-none d-sm-table-cell text-center"},ee={class:"text-center"},te={class:"d-flex flex-column flex-md-row justify-content-center align-items-center"},ae={alt:"",class:"thumbnail me-md-4"},le=["href"],se={class:"d-none d-xxl-table-cell text-center"},ne={class:"d-none d-xxl-table-cell text-center"},oe={class:"d-none d-xxl-table-cell text-center"},de={class:"text-center"},ie={class:"btn-group btn-group-sm",role:"group"},re=["onClick"],ce=["onClick"],me={class:"mb-8"},ue={class:"img-thumbnail",style:{"max-height":"12rem"}},ge={class:"img-thumbnail",style:{"max-height":"20rem"}},pe=["value"],fe={__name:"ImagesView",setup(N){const x=V(),p=z(),{openLoading:b,closeLoading:c}=x,{pushMessage:d}=p,s=r([]),U=r({}),v=r(null),I=r(null),_=r({id:"",imageUrl:""}),i=r({id:"",type:"",imageUrl:"",user:{nickName:""},createdAt:"",updatedAt:""});async function y(a=1){var t,n;b();try{const l=await C({page:a});s.value=l.data.data.results,U.value=l.data.data.pagination,c()}catch(l){d({style:"danger",title:"載入失敗",text:((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"載入失敗，請重整網頁"}),c()}}async function D(a){var t,n,l;b();try{const m=await L(a),{status:k}=m.data;k==="success"?(d({style:"success",title:"刪除成功",text:"圖片刪除成功，請等待載入畫面"}),y()):d({style:"danger",title:"刪除失敗",text:"圖片刪除失敗，請重整網頁"}),(t=v.value)==null||t.hideModal(),c()}catch(m){d({style:"danger",title:"刪除失敗",text:((l=(n=m.response)==null?void 0:n.data)==null?void 0:l.message)||"圖片刪除失敗，請重整網頁"}),c()}}function R(a){var t;_.value={id:a._id,imageUrl:a.imageUrl},(t=v.value)==null||t.openModal()}function T(a){var t,n;i.value={id:a._id,type:a.type,imageUrl:a.imageUrl,userNickName:(t=a.user)==null?void 0:t.nickName,createdAt:a.createdAt,updatedAt:a.updatedAt},(n=I.value)==null||n.openModal()}return B(()=>{y()}),(a,t)=>{const n=j("lazy");return f(),h(A,null,[t[4]||(t[4]=e("h1",{class:"mb-14 h3"},"圖片管理",-1)),e("div",Q,[e("table",X,[t[0]||(t[0]=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"圖片類型"),e("th",{class:"text-center"},"圖片網址"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"上傳會員"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"更新時間"),e("th",{class:"text-center",width:"160"},"編輯")])],-1)),e("tbody",null,[(f(!0),h(A,null,F(s.value,l=>{var m;return f(),h("tr",{key:l._id},[e("td",Y,"#"+o(l._id.slice(-5)),1),e("td",Z,o(l.type),1),e("td",ee,[e("div",te,[w(e("img",ae,null,512),[[n,l.imageUrl]]),e("a",{href:l.imageUrl,target:"_blank",class:"text-decoration-underline"}," 開啟圖片 ",8,le)])]),e("td",se,o((m=l.user)==null?void 0:m.nickName),1),e("td",ne,o(a.$getTime(l.createdAt)),1),e("td",oe,o(a.$getTime(l.updatedAt)),1),e("td",de,[e("div",ie,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:k=>T(l)}," 看更多 ",8,re),e("button",{type:"button",class:"btn btn-outline-danger",onClick:k=>R(l)}," 刪除 ",8,ce)])])])}),128))])])]),$(E,{pagination:U.value,onUpdatePage:y},null,8,["pagination"]),$(G,{ref_key:"delModalRef",ref:v,"del-id":_.value.id,onDelItem:D},{"modal-header":g(()=>t[1]||(t[1]=[u(" 刪除圖片 ")])),"modal-content":g(()=>[e("p",me,[t[2]||(t[2]=u(" 確定要刪除 ")),e("strong",null," 圖片：#"+o(_.value.id.slice(-5)),1)]),w(e("img",ue,null,512),[[n,_.value.imageUrl]])]),_:1},8,["del-id"]),$(O,{ref_key:"imageModalRef",ref:I},{"modal-header":g(()=>[u(" 圖片 #"+o(i.value.id.slice(-5)),1)]),"modal-image":g(()=>[w(e("img",ge,null,512),[[n,i.value.imageUrl]])]),"modal-content":g(()=>[t[3]||(t[3]=e("label",{for:"imageUrl",class:"form-label"},"網址連結：",-1)),e("input",{type:"text",id:"imageUrl",class:"form-control mb-8",value:i.value.imageUrl,disabled:""},null,8,pe),e("p",null,"上傳會員："+o(i.value.userNickName),1),e("p",null,"建立時間："+o(a.$getTime(i.value.createdAt)),1),e("p",null,"更新時間："+o(a.$getTime(i.value.updatedAt)),1)]),_:1},512)],64)}}};export{fe as default};
