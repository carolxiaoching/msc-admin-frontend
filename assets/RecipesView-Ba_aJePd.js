import{e as B,d as G,c as L,i as A}from"./api-BRBvrrQh.js";import{l as F,m as E,r,z as O,c as d,a as e,b as _,w as p,d as Q,F as y,S as N,T as W,o as c,f as u,t as o,W as P,O as T,Q as Y,Y as j,n as $}from"./index-NowiT2I7.js";import{_ as q,a as H}from"./DelModal-T7J-5MaA.js";const J={class:"mb-8 text-end"},K={class:"table-responsive"},X={class:"table align-middle mb-14"},Z={class:"d-none d-md-table-cell text-center"},ee={class:"text-center"},te={class:"d-flex align-items-center"},se={key:0,class:"thumbnail me-4"},le={key:1,class:"thumbnail me-4"},ae={class:"d-none d-md-table-cell text-center"},ne={class:"d-none d-xxl-table-cell text-center"},oe={class:"d-flex flex-wrap mb-0 list-unstyled"},de={class:"badge text-bg-secondary"},ce={class:"d-none d-xxxl-table-cell text-center"},ie={class:"d-none d-lg-table-cell text-center"},re={class:"d-flex flex-column align-items-center"},ue={key:0,class:"thumbnail me-4 rounded-circle"},xe={key:1,class:"thumbnail me-4 rounded-circle"},ge={class:"d-none d-xxl-table-cell text-center"},be={class:"d-none d-xxl-table-cell text-center"},_e={class:"d-none d-xxxl-table-cell text-center"},pe={class:"d-none d-xxxl-table-cell text-center"},he={class:"text-center"},me={class:"btn-group btn-group-sm",role:"group"},ve=["onClick"],fe={class:"mb-8"},De={__name:"RecipesView",setup(ye){const I=F(),U=E(),{openLoading:h,closeLoading:i}=I,{pushMessage:x}=U,w=r([]),k=r([]),R=r([]),D=r({}),m=r(null),g=r({id:"",title:""});async function v(l=1){var t,a;h();try{const n=await L({page:l});w.value=n.data.data.results,D.value=n.data.data.pagination,i()}catch(n){x({style:"danger",title:"載入失敗",text:((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),i()}}async function z(){var l,t;h();try{const a=await B({noPagination:!0}),n=await G({noPagination:!0});R.value=a.data.data,k.value=n.data.data,await v(),i()}catch(a){x({style:"danger",title:"載入失敗",text:((t=(l=a.response)==null?void 0:l.data)==null?void 0:t.message)||"載入失敗，請重整網頁"}),i()}}async function S(l){var t,a,n;h();try{const s=await A(l),{status:b}=s.data;b==="success"?(x({style:"success",title:"刪除成功",text:"刪除成功，請等待載入畫面"}),v()):x({style:"danger",title:"刪除失敗",text:"刪除失敗，請重整網頁"}),(t=m.value)==null||t.hideModal(),i()}catch(s){x({style:"danger",title:"刪除失敗",text:((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"刪除失敗，請重整網頁"}),i()}}function V(l){var t;g.value={id:l._id,title:l.title},(t=m.value)==null||t.openModal()}return O(()=>{z()}),(l,t)=>{const a=Q("router-link"),n=W("lazy");return c(),d(y,null,[t[6]||(t[6]=e("h1",{class:"mb-4 h3"},"食譜管理",-1)),e("div",J,[_(a,{to:"/dashboard/recipe/new",class:"btn btn-primary"},{default:p(()=>t[0]||(t[0]=[e("i",{class:"bi bi-plus-lg me-8"},null,-1),u(" 新增食譜 ")])),_:1})]),e("div",K,[e("table",X,[t[4]||(t[4]=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"text-center"},"食譜名稱"),e("th",{class:"d-none d-md-table-cell text-center",width:"120"},"分類"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"標籤"),e("th",{class:"d-none d-xxxl-table-cell text-center",width:"80"},"收藏人數"),e("th",{class:"d-none d-lg-table-cell text-center",width:"120"},"發布者"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"80"},"公開狀態"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"80"},"編輯推薦"),e("th",{class:"d-none d-xxxl-table-cell text-center",width:"120"},"建立時間"),e("th",{class:"d-none d-xxxl-table-cell text-center",width:"120"},"更新時間"),e("th",{class:"text-center",width:"160"},"編輯")])],-1)),e("tbody",null,[(c(!0),d(y,null,N(w.value,s=>{var b,C,M;return c(),d("tr",{key:s._id},[e("td",Z,"#"+o(s._id.slice(-5)),1),e("td",ee,[e("div",te,[s.coverImgUrl?P((c(),d("img",se,null,512)),[[n,s.coverImgUrl]]):(c(),d("div",le,t[1]||(t[1]=[e("i",{class:"bi bi-person-fill"},null,-1)]))),u(" "+o(s.title),1)])]),e("td",ae,o(T(Y)(k.value,s.category)),1),e("td",ne,[e("ul",oe,[(c(!0),d(y,null,N(s.tags,f=>(c(),d("li",{class:"me-4 fs-6",key:f},[e("span",de,o(T(j)(R.value,f)),1)]))),128))])]),e("td",ce,o(s.collectsCount),1),e("td",ie,[e("div",re,[(b=s.user)!=null&&b.avatarImgUrl?P((c(),d("img",ue,null,512)),[[n,(C=s.user)==null?void 0:C.avatarImgUrl]]):(c(),d("div",xe,t[2]||(t[2]=[e("i",{class:"bi bi-person-fill"},null,-1)]))),u(" "+o((M=s.user)==null?void 0:M.nickName),1)])]),e("td",ge,[e("span",{class:$(["badge",{"text-bg-primary":s.isPublic,"text-bg-light":!s.isPublic}])},o(s.isPublic?"公開":"私人"),3)]),e("td",be,[e("span",{class:$(["badge",{"text-bg-primary":s.isRecommended,"text-bg-light":!s.isRecommended}])},o(s.isRecommended?"是":"否"),3)]),e("td",_e,o(l.$getTime(s.createdAt)),1),e("td",pe,o(l.$getTime(s.updatedAt)),1),e("td",he,[e("div",me,[_(a,{to:`/dashboard/recipe/${s._id}`,class:"btn btn-outline-dark"},{default:p(()=>t[3]||(t[3]=[u(" 編輯 ")])),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:f=>V(s)}," 刪除 ",8,ve)])])])}),128))])])]),_(q,{pagination:D.value,onUpdatePage:v},null,8,["pagination"]),_(H,{ref_key:"delModalRef",ref:m,"del-id":g.value.id,onDelItem:S},{"modal-header":p(()=>[u(" 刪除食譜 #"+o(g.value.id.slice(-5)),1)]),"modal-content":p(()=>[e("p",fe,[t[5]||(t[5]=u(" 確定要刪除食譜： ")),e("strong",null,o(g.value.title),1)])]),_:1},8,["del-id"])],64)}}};export{De as default};
