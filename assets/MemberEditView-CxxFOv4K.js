import{l as N,m as q,r as _,z as R,X as E,u as F,c as B,a as e,b as i,w as p,d as f,o as C,n as v,f as S}from"./index-DLEIqx4g.js";import{g as j,h as z}from"./api-BuVyP45F.js";import{_ as A}from"./UploadComponent-h3FBgQMM.js";const D={class:"container-fluid"},L={class:"row gx-16 justify-content-center"},T={class:"col-12 col-xxl-6 mb-16"},$={class:"d-flex flex-column h-100 py-16 px-14 px-md-16 bg-white rounded shadow-sm"},G={class:"flex-fill d-flex flex-column justify-content-center m-lg-16"},X={class:"col-12 col-xxl-6 mb-16"},H={class:"p-14 p-md-16 bg-white shadow-sm rounded"},J={class:"mb-8"},K=["value"],O={class:"mb-8"},P=["value"],Q={class:"mb-8"},W={class:"mb-8"},Y={class:"mb-16"},Z={class:"text-center"},ee=["disabled"],se={class:"col-12 text-center"},ie={__name:"MemberEditView",setup(le){const g=F(),h=E(),k=N(),w=q(),{openLoading:x,closeLoading:b}=k,{pushMessage:r}=w,I=_(null),m=_({}),t=_({});async function M(l){var s,o;x();try{const a=await j(l),{status:n,data:u}=a.data;n==="success"?(m.value={...u},t.value={...u}):(r({style:"danger",title:"載入失敗",text:"會員取得失敗，將轉回會員列表頁面"}),g.push("/dashboard/member")),b()}catch(a){r({style:"danger",title:"載入失敗",text:((o=(s=a.response)==null?void 0:s.data)==null?void 0:o.message)||"會員取得失敗，將轉回會員列表頁面"}),b(),g.push("/dashboard/member")}}async function y(l,s){var o,a;x(),s!=="updateAvatarImgUrl"&&delete l.avatarImgUrl;try{const n=await z(l,m.value._id),{status:u,data:d}=n.data;u==="success"?(r({style:"success",title:"更新成功",text:"更新成功"}),m.value={...d},t.value={...d}):r({style:"danger",title:"更新失敗",text:"更新失敗，請重整網頁"}),b()}catch(n){r({style:"danger",title:"更新失敗",text:((a=(o=n.response)==null?void 0:o.data)==null?void 0:a.message)||"更新失敗，請重整網頁"}),b()}}function U(l){y({avatarImgUrl:l},"updateAvatarImgUrl")}return R(()=>{const{id:l}=h.params;l?M(l):(r({style:"danger",title:"請輸入正確會員 ID",text:"會員 ID 錯誤"}),g.push("/dashboard/member"))}),(l,s)=>{const o=f("VField"),a=f("ErrorMessage"),n=f("VForm"),u=f("router-link");return C(),B("div",D,[e("div",L,[s[14]||(s[14]=e("div",{class:"col-12 mb-14"},[e("h1",{class:"h3"},"編輯會員")],-1)),e("div",T,[e("div",$,[s[4]||(s[4]=e("h2",{class:"title mb-11"},[e("span",{class:"titleIcon bg-secondary-subtle"},[e("i",{class:"bi bi-image-fill"})]),e("span",null," 會員頭像 ")],-1)),e("div",G,[i(A,{"temp-image-url":m.value.avatarImgUrl,imageType:"avatar",onUpdateImage:U},null,8,["temp-image-url"])])])]),e("div",X,[e("div",H,[s[12]||(s[12]=e("h2",{class:"title mb-11"},[e("span",{class:"titleIcon bg-secondary-subtle"},[e("i",{class:"bi bi-image-fill"})]),e("span",null," 基本資料 ")],-1)),i(n,{ref_key:"formRef",ref:I,onSubmit:s[3]||(s[3]=d=>y(t.value))},{default:p(({errors:d,meta:V})=>[e("div",J,[s[5]||(s[5]=e("label",{for:"id",class:"form-label"}," 會員編號： ",-1)),e("input",{type:"text",name:"id",id:"id",class:"form-control",value:m.value._id,disabled:""},null,8,K)]),e("div",O,[s[6]||(s[6]=e("label",{for:"email",class:"form-label"}," 電子信箱： ",-1)),e("input",{type:"email",name:"email",id:"email",class:"form-control",value:m.value.email,disabled:""},null,8,P)]),e("div",Q,[s[7]||(s[7]=e("label",{for:"nickName",class:"form-label"}," 暱稱： ",-1)),i(o,{type:"text",name:"暱稱",id:"nickName",class:v(["form-control",{"is-invalid":d.暱稱}]),placeholder:"請輸入暱稱",rules:"required",modelValue:t.value.nickName,"onUpdate:modelValue":s[0]||(s[0]=c=>t.value.nickName=c),required:""},null,8,["class","modelValue"]),i(a,{name:"暱稱",class:"invalid-feedback"})]),e("div",W,[s[9]||(s[9]=e("label",{for:"gender",class:"form-label"}," 性別： ",-1)),i(o,{as:"select",name:"性別",id:"gender",class:v(["form-select",{"is-invalid":d.性別}]),placeholder:"請選擇性別",rules:"required",modelValue:t.value.gender,"onUpdate:modelValue":s[1]||(s[1]=c=>t.value.gender=c),required:""},{default:p(()=>s[8]||(s[8]=[e("option",{value:"secret",select:""},"秘密",-1),e("option",{value:"female"},"女生",-1),e("option",{value:"male"},"男生",-1)])),_:2},1032,["class","modelValue"]),i(a,{name:"性別",class:"invalid-feedback"})]),e("div",Y,[s[11]||(s[11]=e("label",{for:"role",class:"form-label"}," 權限： ",-1)),i(o,{as:"select",name:"權限",id:"role",class:v(["form-select",{"is-invalid":d.權限}]),placeholder:"請選擇權限",rules:"required",modelValue:t.value.role,"onUpdate:modelValue":s[2]||(s[2]=c=>t.value.role=c),required:""},{default:p(()=>s[10]||(s[10]=[e("option",{value:"member",select:""},"會員",-1),e("option",{value:"admin"},"管理員",-1)])),_:2},1032,["class","modelValue"]),i(a,{name:"權限",class:"invalid-feedback"})]),e("div",Z,[e("button",{type:"submit","aria-disabled":"true",class:v(["btn btn-primary w-75",{disabled:!V.valid}]),disabled:!V.valid}," 更新基本資料 ",10,ee)])]),_:1},512)])]),e("div",se,[i(u,{to:"/dashboard/members",class:"btn btn-outline-primary"},{default:p(()=>s[13]||(s[13]=[e("i",{class:"bi bi-arrow-90deg-left me-8"},null,-1),S(" 返回會員列表 ")])),_:1})])])])}}};export{ie as default};
