import{q,r as B,e as I,s as U}from"./api-tKCg3TZ9.js";import{l as F,m as S,r,a0 as z,M as G,d as V,c as x,o as h,a as t,b as v,w as T,e as j,a1 as O,f,n as R,t as c,z as P,F as D,S as H}from"./index-CIIQbgs8.js";import{_ as J,a as K}from"./DelModal-DsZnU4wa.js";const Q={class:"modal-dialog modal-dialog-centered"},W={class:"modal-content overflow-hidden"},X={class:"p-11"},Y={class:"modal-title title mb-8",id:"tagEditModalLabel"},Z={key:0},tt={class:"d-flex px-11 py-8 bg-light"},et=["onClick"],at=["disabled"],st={__name:"TagEditModal",props:{tempTag:{type:Object,default(){return{id:"",title:"",createdAt:"",updatedAt:""}}}},emits:["getTags"],setup(L,{expose:k,emit:A}){const M=F(),u=S(),{openLoading:p,closeLoading:y}=M,{pushMessage:g}=u,m=r(null),{openModal:$,hideModal:b}=z(m),l=r({id:"",title:"",createdAt:"",updatedAt:""});k({openModal:$,hideModal:b});const _=L,w=A;G(_,o=>{l.value=o.tempTag});async function C(o,{resetForm:s}){var d,n;p();const e=l.value.id?q:B,a=l.value.id?"更新":"新增";try{const i=await e({title:l.value.title},l.value.id),{status:E}=i.data;E==="success"?(g({style:"success",title:`${a}成功`,text:`標籤${a}成功，請等待載入畫面`}),s(),w("getTags")):g({style:"danger",title:`${a}失敗`,text:`標籤${a}失敗，請重整網頁`}),y(),b()}catch(i){g({style:"danger",title:`${a}失敗`,text:((n=(d=i.response)==null?void 0:d.data)==null?void 0:n.message)||`標籤${a}失敗，請重整網頁`}),y()}}return(o,s)=>{const e=V("VField"),a=V("ErrorMessage"),d=V("VForm");return h(),x("div",{class:"modal fade",id:"tagEditModal",tabindex:"-1","aria-labelledby":"tagEditModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"tagEditModalRef",ref:m},[t("div",Q,[t("div",W,[v(d,{class:"modal-body p-0",ref:"form",onSubmit:C},{default:T(({errors:n,meta:i,resetForm:E})=>[t("div",X,[t("h1",Y,[s[2]||(s[2]=t("span",{class:"titleIcon bg-dark-subtl"},[t("i",{class:"bi bi-pencil-fill"})],-1)),O(o.$slots,"modal-header",{},()=>[s[1]||(s[1]=f("標題"))])]),t("div",{class:R({"mb-8":l.value.createdAt})},[s[3]||(s[3]=t("label",{for:"title",class:"form-label"},[t("span",{class:"text-danger"},"*"),f(" 標籤標題： ")],-1)),v(e,{type:"text",name:"標籤標題",id:"title",class:R(["form-control",{"is-invalid":n.標籤標題}]),placeholder:"請輸入標籤標題",rules:"required",modelValue:l.value.title,"onUpdate:modelValue":s[0]||(s[0]=N=>l.value.title=N),required:""},null,8,["class","modelValue"]),v(a,{name:"標籤標題",class:"invalid-feedback"})],2),l.value.createdAt?(h(),x("div",Z,[t("p",null,"建立時間："+c(o.$getTime(l.value.createdAt)),1),t("p",null,"更新時間："+c(o.$getTime(l.value.updatedAt)),1)])):j("",!0)]),t("div",tt,[t("button",{type:"button",class:"w-50 btn btn-outline-primary me-8","data-bs-dismiss":"modal",onClick:E}," 取消 ",8,et),t("button",{type:"submit","aria-disabled":"true",class:R(["w-50 btn btn-primary",{disabled:!i.valid}]),disabled:!i.valid}," 確定送出 ",10,at)])]),_:3},512)])])],512)}}},lt={class:"mb-8 text-end"},dt={class:"table-responsive"},ot={class:"table mb-14 align-middle"},nt={class:"d-none d-sm-table-cell text-center"},it={class:"text-center"},rt={class:"d-none d-xxl-table-cell text-center"},ct={class:"d-none d-xxl-table-cell text-center"},ut={class:"text-center"},pt={class:"btn-group btn-group-sm",role:"group"},gt=["onClick"],mt=["onClick"],vt={__name:"TagsView",setup(L){const k=F(),A=S(),{openLoading:M,closeLoading:u}=k,{pushMessage:p}=A,y=r([]),g=r({}),m=r(null),$=r(null),b=r({id:"",title:""}),l=r({id:"",title:"",createdAt:"",updatedAt:""});async function _(s=1){var e,a;M();try{const d=await I({page:s});y.value=d.data.data.results,g.value=d.data.data.pagination,u()}catch(d){p({style:"danger",title:"載入失敗",text:((a=(e=d.response)==null?void 0:e.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),u()}}async function w(s){var e,a,d;M();try{const n=await U(s),{status:i}=n.data;i==="success"?(p({style:"success",title:"刪除成功",text:"標籤刪除成功，請等待載入畫面"}),_()):p({style:"danger",title:"刪除失敗",text:"標籤刪除失敗，請重整網頁"}),(e=m.value)==null||e.hideModal(),u()}catch(n){p({style:"danger",title:"刪除失敗",text:((d=(a=n.response)==null?void 0:a.data)==null?void 0:d.message)||"標籤刪除失敗，請重整網頁"}),u()}}function C(s){var e;b.value={id:s._id,title:s.title},(e=m.value)==null||e.openModal()}function o(s,e){var a;s==="create"?l.value={id:"",title:"",createdAt:"",updatedAt:""}:l.value={id:e._id,title:e.title,createdAt:e.createdAt,updatedAt:e.updatedAt},(a=$.value)==null||a.openModal()}return P(()=>{_()}),(s,e)=>(h(),x(D,null,[e[5]||(e[5]=t("h1",{class:"mb-4 h3"},"標籤管理",-1)),t("div",lt,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=a=>o("create"))},e[1]||(e[1]=[t("i",{class:"bi bi-plus-lg me-8"},null,-1),f(" 新增標籤 ")]))]),t("div",dt,[t("table",ot,[e[2]||(e[2]=t("thead",null,[t("tr",{class:"table-active"},[t("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),t("th",{class:"text-center"},"標籤名稱"),t("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"建立時間"),t("th",{class:"d-none d-xxl-table-cell text-center",width:"200"},"更新時間"),t("th",{class:"text-center",width:"200"},"編輯")])],-1)),t("tbody",null,[(h(!0),x(D,null,H(y.value,a=>(h(),x("tr",{key:a._id},[t("td",nt,"#"+c(a._id.slice(-5)),1),t("td",it,c(a.title),1),t("td",rt,c(s.$getTime(a.createdAt)),1),t("td",ct,c(s.$getTime(a.updatedAt)),1),t("td",ut,[t("div",pt,[t("button",{type:"button",class:"btn btn-outline-dark",onClick:d=>o("edit",a)}," 編輯 ",8,gt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:d=>C(a)}," 刪除 ",8,mt)])])]))),128))])])]),v(J,{pagination:g.value,onUpdatePage:_},null,8,["pagination"]),v(K,{ref_key:"delModalRef",ref:m,"del-id":b.value.id,onDelItem:w},{"modal-header":T(()=>e[3]||(e[3]=[f(" 刪除標籤 ")])),"modal-content":T(()=>[e[4]||(e[4]=f(" 確定要刪除 ")),t("strong",null," 標籤： "+c(b.value.title),1)]),_:1},8,["del-id"]),v(st,{ref_key:"tagEditModalRef",ref:$,"temp-tag":l.value,onGetTags:_},{"modal-header":T(()=>[f(c(l.value.id?"編輯標籤":"新增標籤"),1)]),_:1},8,["temp-tag"])],64))}};export{vt as default};
