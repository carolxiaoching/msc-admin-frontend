import{t as C,u as L}from"./api-tKCg3TZ9.js";import{r,a0 as S,c as h,o as f,a as e,a1 as k,f as m,l as T,m as V,z as B,b as M,F as U,S as F,w as g,t as o}from"./index-CIIQbgs8.js";import{_ as j,a as z}from"./DelModal-DsZnU4wa.js";const E={class:"modal-dialog modal-dialog-centered"},G={class:"modal-content overflow-hidden"},P={class:"modal-body p-0"},q={class:"p-11"},H={class:"modal-title title mb-8",id:"imageModalLabel"},J={class:"my-11 text-center"},K={__name:"ImageModal",setup(I,{expose:x}){const p=r(null),{openModal:b,hideModal:c}=S(p);return x({openModal:b,hideModal:c}),(d,l)=>(f(),h("div",{class:"modal fade",id:"imageModal",tabindex:"-1","aria-labelledby":"imageModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"imageModalRef",ref:p},[e("div",E,[e("div",G,[e("div",P,[e("div",q,[e("h1",H,[l[1]||(l[1]=e("span",{class:"titleIcon bg-dark-subtle"},[e("i",{class:"bi bi-pencil-fill"})],-1)),k(d.$slots,"modal-header",{},()=>[l[0]||(l[0]=m("標題"))])]),e("div",J,[k(d.$slots,"modal-image",{},()=>[l[2]||(l[2]=m("圖片"))])]),k(d.$slots,"modal-content",{},()=>[l[3]||(l[3]=m("內容"))])]),l[4]||(l[4]=e("div",{class:"px-11 py-8 bg-light text-center"},[e("button",{type:"button",class:"w-50 btn btn-primary","data-bs-dismiss":"modal"},"關閉")],-1))])])])],512))}},O={class:"table-responsive"},Q={class:"table mb-14 align-middle"},W={class:"d-none d-sm-table-cell text-center"},X={class:"d-none d-sm-table-cell text-center"},Y={class:"text-center"},Z={class:"d-flex flex-column flex-md-row justify-content-center align-items-center"},ee=["src"],te=["href"],ae={class:"d-none d-xxl-table-cell text-center"},se={class:"d-none d-xxl-table-cell text-center"},le={class:"d-none d-xxl-table-cell text-center"},ne={class:"text-center"},oe={class:"btn-group btn-group-sm",role:"group"},de=["onClick"],ie=["onClick"],re={class:"mb-8"},ce=["src"],me=["src"],ue=["value"],_e={__name:"ImagesView",setup(I){const x=T(),p=V(),{openLoading:b,closeLoading:c}=x,{pushMessage:d}=p,l=r([]),$=r({}),v=r(null),w=r(null),_=r({id:"",imageUrl:""}),i=r({id:"",type:"",imageUrl:"",user:{nickName:""},createdAt:"",updatedAt:""});async function y(s=1){var t,a;b();try{const n=await C({page:s});l.value=n.data.data.results,$.value=n.data.data.pagination,c()}catch(n){d({style:"danger",title:"載入失敗",text:((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"載入失敗，請重整網頁"}),c()}}async function A(s){var t,a,n;b();try{const u=await L(s),{status:D}=u.data;D==="success"?(d({style:"success",title:"刪除成功",text:"圖片刪除成功，請等待載入畫面"}),y()):d({style:"danger",title:"刪除失敗",text:"圖片刪除失敗，請重整網頁"}),(t=v.value)==null||t.hideModal(),c()}catch(u){d({style:"danger",title:"刪除失敗",text:((n=(a=u.response)==null?void 0:a.data)==null?void 0:n.message)||"圖片刪除失敗，請重整網頁"}),c()}}function N(s){var t;_.value={id:s._id,imageUrl:s.imageUrl},(t=v.value)==null||t.openModal()}function R(s){var t,a;i.value={id:s._id,type:s.type,imageUrl:s.imageUrl,userNickName:(t=s.user)==null?void 0:t.nickName,createdAt:s.createdAt,updatedAt:s.updatedAt},(a=w.value)==null||a.openModal()}return B(()=>{y()}),(s,t)=>(f(),h(U,null,[t[4]||(t[4]=e("h1",{class:"mb-14 h3"},"圖片管理",-1)),e("div",O,[e("table",Q,[t[0]||(t[0]=e("thead",null,[e("tr",{class:"table-active"},[e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"ID 編號"),e("th",{class:"d-none d-sm-table-cell text-center",width:"120"},"圖片類型"),e("th",{class:"text-center"},"圖片網址"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"上傳會員"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"建立時間"),e("th",{class:"d-none d-xxl-table-cell text-center",width:"160"},"更新時間"),e("th",{class:"text-center",width:"160"},"編輯")])],-1)),e("tbody",null,[(f(!0),h(U,null,F(l.value,a=>{var n;return f(),h("tr",{key:a._id},[e("td",W,"#"+o(a._id.slice(-5)),1),e("td",X,o(a.type),1),e("td",Y,[e("div",Z,[e("img",{src:a.imageUrl,alt:"",class:"thumbnail me-md-4"},null,8,ee),e("a",{href:a.imageUrl,target:"_blank",class:"text-decoration-underline"}," 開啟圖片 ",8,te)])]),e("td",ae,o((n=a.user)==null?void 0:n.nickName),1),e("td",se,o(s.$getTime(a.createdAt)),1),e("td",le,o(s.$getTime(a.updatedAt)),1),e("td",ne,[e("div",oe,[e("button",{type:"button",class:"btn btn-outline-dark",onClick:u=>R(a)}," 看更多 ",8,de),e("button",{type:"button",class:"btn btn-outline-danger",onClick:u=>N(a)}," 刪除 ",8,ie)])])])}),128))])])]),M(j,{pagination:$.value,onUpdatePage:y},null,8,["pagination"]),M(z,{ref_key:"delModalRef",ref:v,"del-id":_.value.id,onDelItem:A},{"modal-header":g(()=>t[1]||(t[1]=[m(" 刪除圖片 ")])),"modal-content":g(()=>[e("p",re,[t[2]||(t[2]=m(" 確定要刪除 ")),e("strong",null," 圖片：#"+o(_.value.id.slice(-5)),1)]),e("img",{src:_.value.imageUrl,class:"img-thumbnail",style:{"max-height":"12rem"}},null,8,ce)]),_:1},8,["del-id"]),M(K,{ref_key:"imageModalRef",ref:w},{"modal-header":g(()=>[m(" 圖片 #"+o(i.value.id.slice(-5)),1)]),"modal-image":g(()=>[e("img",{src:i.value.imageUrl,class:"img-thumbnail",style:{"max-height":"20rem"}},null,8,me)]),"modal-content":g(()=>[t[3]||(t[3]=e("label",{for:"imageUrl",class:"form-label"},"網址連結：",-1)),e("input",{type:"text",id:"imageUrl",class:"form-control mb-8",value:i.value.imageUrl,disabled:""},null,8,ue),e("p",null,"上傳會員："+o(i.value.userNickName),1),e("p",null,"建立時間："+o(s.$getTime(i.value.createdAt)),1),e("p",null,"更新時間："+o(s.$getTime(i.value.updatedAt)),1)]),_:1},512)],64))}};export{_e as default};
